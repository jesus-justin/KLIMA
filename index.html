<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Track local weather with multi-source forecasts including PAGASA. Plan your jogs with intelligent suitability scoring." />
    <meta name="theme-color" content="#38bdf8" />
    <link rel="manifest" href="manifest.json" />
    <title>KLIMA ‚Äî Local Weather & Jog Planner</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="stylesheet" href="assets/css/premium-design.css" />
    <link rel="stylesheet" href="assets/css/micro-interactions.css" />
    <link rel="stylesheet" href="assets/css/dynamic-effects.css" />
    <link rel="stylesheet" href="assets/css/jog-tips.css" />
    <link rel="stylesheet" href="assets/css/weather-trends.css" />
    <link rel="stylesheet" href="assets/css/weekly-heatmap.css" />
    <link rel="stylesheet" href="assets/css/settings.css" />
    <link rel="stylesheet" href="assets/css/uv-index.css" />
  </head>
  <body>
    <a class="skip-link" href="#main-content">Skip to content</a>
    <header class="app-header">
      <div class="brand">KLIMA</div>
      <div class="controls">
        <form id="search-form" class="search">
          <input id="search-input" type="text" placeholder="Search city (e.g., Manila)" aria-label="Search city" />
          <button type="submit" title="Search">Search</button>
        </form>
  <button id="btn-geolocate" class="secondary" title="Use my location">Use my location</button>
  <a href="alerts.html" id="btn-alerts" class="secondary" title="Weather alerts and news" style="text-decoration:none; display:inline-flex; align-items:center; gap:6px">News <span id="alerts-badge" class="badge" style="display:none; background:#dc2626; color:#fff; border-radius:10px; padding:1px 6px; font-size:12px;">0</span></a>
  <a href="compare.html" class="secondary" title="Compare multiple weather sources" style="text-decoration:none; padding:8px 12px">Compare</a>
  <button id="btn-favorite" class="secondary" title="Add to favorites">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
    </svg>
  </button>
  <button id="btn-share" class="secondary" title="Share location">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
      <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
    </svg>
  </button>
  <!-- Light bulb theme toggle -->
  <div id="bulb-toggle" class="bulb-toggle" role="button" aria-label="Toggle theme" title="Toggle theme">
    <svg width="64" height="120" viewBox="0 0 64 120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <defs>
        <radialGradient id="bulbGlow" cx="50%" cy="40%" r="60%">
          <stop offset="0%" stop-color="#fff8c7"/>
          <stop offset="60%" stop-color="#fff0a6" stop-opacity="0.9"/>
          <stop offset="100%" stop-color="#fff0a6" stop-opacity="0"/>
        </radialGradient>
        <clipPath id="bulbClip">
          <ellipse cx="32" cy="28" rx="14" ry="18"/>
        </clipPath>
      </defs>
      <g class="assembly">
        <!-- Ceiling mount line -->
        <line x1="18" y1="2" x2="46" y2="2" stroke="var(--border)" stroke-width="3" stroke-linecap="round"/>
        <!-- Bulb at the top -->
        <g transform="translate(0,6)">
          <!-- OFF state: outline + highlight only -->
          <g class="state-off">
            <ellipse cx="32" cy="22" rx="14" ry="18" fill="none" stroke="var(--text)" stroke-width="3"/>
            <path d="M23 18 q9 -9 18 0" stroke="#ffffff" stroke-opacity="0.35" stroke-width="3" fill="none" stroke-linecap="round"/>
          </g>
          <!-- ON state: filled glass + filament + highlight -->
          <g class="state-on">
            <ellipse cx="32" cy="22" rx="14" ry="18" fill="#d9f99d" stroke="#111827" stroke-width="3"/>
            <path d="M23 18 q9 -9 18 0" stroke="#ffffff" stroke-opacity="0.5" stroke-width="3" fill="none" stroke-linecap="round"/>
            <polyline points="26,28 30,24 32,28 34,24 38,28" fill="none" stroke="#fef08a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          </g>
          <!-- Cap and base (constant) -->
          <rect x="28" y="32" width="8" height="4" rx="1" fill="var(--panel)" stroke="var(--border)"/>
          <rect x="26" y="36" width="12" height="10" rx="3" fill="var(--panel)" stroke="var(--border)"/>
          <path d="M28 38 h8 M28 40 h8 M28 42 h8" stroke="var(--border)"/>
          <!-- Glow clipped to glass -->
          <g class="glow" clip-path="url(#bulbClip)">
            <rect x="10" y="4" width="44" height="40" fill="url(#bulbGlow)"/>
          </g>
        </g>
        <!-- Rope hanging below the bulb; animated group -->
        <g class="cord-group" transform="translate(0,46)">
          <line class="rope-line" x1="32" y1="0" x2="32" y2="54" stroke="var(--muted)" stroke-width="2" stroke-linecap="round"/>
          <circle class="rope-knob" cx="32" cy="60" r="6" fill="var(--muted)"/>
        </g>
      </g>
    </svg>
  </div>
        <div class="units-toggle" role="group" aria-label="Units">
          <button id="unit-c" class="unit active" data-unit="metric">¬∞C</button>
          <button id="unit-f" class="unit" data-unit="imperial">¬∞F</button>
        </div>
        <label class="lang-picker" for="language-select">
          <span class="visually-hidden">Language</span>
          <select id="language-select" aria-label="Language">
            <option value="en-US">English (US)</option>
            <option value="en-GB">English (UK)</option>
            <option value="es-ES">Espa√±ol</option>
            <option value="fr-FR">Fran√ßais</option>
            <option value="de-DE">Deutsch</option>
            <option value="ja-JP">Êó•Êú¨Ë™û</option>
          </select>
        </label>
        <button id="settings-button" title="Settings">‚öôÔ∏è</button>
      </div>
    </header>

    <!-- Settings Modal -->
    <div id="settings-modal" hidden>
      <div class="settings-panel">
        <div class="settings-header">
          <h2>Settings</h2>
          <button class="settings-close" aria-label="Close settings" onclick="window.closeSettingsModal()">&times;</button>
        </div>
        <div id="settings-content"></div>
      </div>
    </div>

      

    <nav class="app-nav">
      <div class="nav-summary">
        <div class="summary-item">
          <span class="summary-label">Jog Status:</span>
          <div id="jog-summary" class="jog-status-badges">
            <span class="status-badge good"><span id="good-count">0</span> Good</span>
            <span class="status-badge fair"><span id="fair-count">0</span> Fair</span>
            <span class="status-badge poor"><span id="poor-count">0</span> Poor</span>
          </div>
        </div>
      </div>
      <div class="view-toggle" role="group" aria-label="Forecast view">
        <button id="view-daily" class="view-btn active" data-view="daily">Daily</button>
        <button id="view-weekly" class="view-btn" data-view="weekly">Weekly</button>
      </div>
    </nav>

    <main id="main-content" class="container">
      <div id="error-banner" class="alert" role="alert" aria-live="assertive" hidden></div>
      <div id="status-banner" class="alert info" role="status" aria-live="polite" hidden></div>
      
      <!-- Favorites & Recent Quick Access -->
      <div id="quick-access" class="quick-access">
        <div class="quick-section">
          <h3>‚≠ê Favorites</h3>
          <div id="favorites-list" class="quick-list"></div>
        </div>
        <div class="quick-section">
          <h3>üïê Recent</h3>
          <div id="recent-list" class="quick-list"></div>
        </div>
      </div>
      
      <section class="meta">
        <div class="location">
          <h1 id="location-name">‚Äî</h1>
          <div id="date-time" class="subtle">‚Äî</div>
          <div class="meta-badges">
            <span id="confidence-badge" class="meta-badge" style="display:none"></span>
            <span id="aqi-badge" class="meta-badge" style="display:none"></span>
          </div>
        </div>
        <div class="jog-now" id="jog-now" role="status" aria-live="polite">‚Äî</div>
      </section>

      <!-- Jog Tips -->
      <section class="card" id="jog-tips-section">
        <div class="section-title">Today's Jog Tips</div>
        <div id="jog-tips-container"></div>
      </section>

      <!-- Weekly Heatmap -->
      <section class="card" id="heatmap-section">
        <div class="section-title">Next 7 Days Forecast</div>
        <div id="heatmap-container"></div>
      </section>

      <section class="current card" id="current">
        <div class="current-left">
          <img id="current-icon" alt="" />
          <div>
            <div class="temp" id="current-temp">‚Äî</div>
            <div class="desc" id="current-desc">‚Äî</div>
          </div>
        </div>
        <ul class="current-stats">
          <li><span>Feels like</span><strong id="feels-like"‚Äî</strong><span class="inline-trend steady" id="temp-trend-indicator"></span></li>
          <li><span>Humidity</span><strong id="humidity"‚Äî</strong></li>
          <li><span>Wind</span><strong id="wind"‚Äî</strong><span class="inline-trend steady" id="wind-trend-indicator"></span></li>
          <li><span>Precip</span><strong id="precip">‚Äî</strong></li>
          <li><span>UV Index</span><strong id="uvi">‚Äî</strong></li>
          <li><span>Sunrise</span><strong id="sunrise">‚Äî</strong></li>
          <li><span>Sunset</span><strong id="sunset">‚Äî</strong></li>
        </ul>
      </section>

      <!-- UV Index Card -->
      <section class="card">
        <div id="uv-index-card"></div>
      </section>

      <section class="hourly card">
        <div class="section-header">
          <div class="section-title">Next 24 hours</div>
          <button id="toggle-chart" class="toggle-view" style="display:none">Chart View</button>
        </div>
        <div id="hourly-skeleton" class="skeleton-loader" style="display:none">
          <div class="skeleton-bar"></div>
          <div class="skeleton-bar"></div>
          <div class="skeleton-bar"></div>
        </div>
        <div id="hourly-chart-container" style="display:none; padding:20px 0">
          <canvas id="hourly-chart" style="max-height:300px"></canvas>
        </div>
        <div id="now-bar" class="now-bar" aria-live="polite" role="status">
          <img id="nowbar-icon" alt="" />
          <div class="nowbar-line">
            <span class="nowbar-pill" id="nowbar-time">‚Äî</span>
            <span class="nowbar-sep">‚Ä¢</span>
            <span id="nowbar-desc">‚Äî</span>
            <span class="nowbar-sep">‚Ä¢</span>
            <span id="nowbar-temp">‚Äî</span>
            <span class="nowbar-sep">‚Ä¢</span>
            <span id="nowbar-precip">‚Äî</span>
          </div>
        </div>
        <div id="hourly-grid" class="hourly-grid" aria-live="polite"></div>
      </section>

      <section class="daily card">
        <div class="section-title">Next 7 days</div>
        <div id="daily-grid" class="daily-grid"></div>
      </section>

      <!-- Chance of Rain Chart -->
      <section class="card rain-chart-section">
        <div class="section-title">Chance of rain</div>
        <div class="rain-chart-container">
          <canvas id="rain-chart" style="max-height:280px"></canvas>
        </div>
      </section>

      <!-- Global Map Section -->
      <section class="card map-section">
        <div class="section-header">
          <div class="section-title">Global map</div>
          <button class="toggle-view" onclick="alert('Full map view coming soon!')">View wide ‚ú®</button>
        </div>
        <div class="map-container">
          <div class="map-placeholder">
            <img src="https://api.mapbox.com/styles/v1/mapbox/dark-v11/static/-180,-85,1/1200x500@2x?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw" alt="Global weather map" loading="lazy" decoding="async" style="width:100%; border-radius:12px; opacity:0.7">
            <div class="map-markers" id="map-markers"></div>
            <div class="map-intro-card">
              <img src="https://images.unsplash.com/photo-1527482797697-8795b05a13fe?w=400&h=200&fit=crop" alt="Weather satellite" loading="lazy" decoding="async" style="width:100%; border-radius:8px; margin-bottom:12px">
              <p style="margin:0 0 14px 0; font-size:16px; line-height:1.5">Explore global map of wind, weather and ocean conditions.</p>
              <button class="toggle-view" style="width:100%; padding:12px">Get started</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Other Large Cities -->
      <section class="card cities-section">
        <div class="section-header">
          <div class="section-title">Other large cities</div>
          <button class="toggle-view" onclick="location.href='compare.html'">Show All ‚Üí</button>
        </div>
        <div class="cities-grid" id="cities-grid">
          <!-- Will be populated by JavaScript -->
        </div>
      </section>
    </main>

    <footer class="footer">
      <div>
        Data source: <span id="data-source">‚Äî</span> ‚Ä¢ Built for planning better jogs
      </div>
    </footer>

    <script src="assets/js/favorites.js" defer></script>
    <script src="assets/js/weather-effects.js" defer></script>
    <script src="assets/js/theme.js" defer></script>
    <script src="assets/js/premium-features.js" defer></script>
    <script src="assets/js/micro-interactions.js" defer></script>
    <script src="assets/js/dynamic-effects.js" defer></script>
    <script src="assets/js/jog-tips.js" defer></script>
    <script src="assets/js/weather-trends.js" defer></script>
    <script src="assets/js/weekly-heatmap.js" defer></script>
    <script src="assets/js/settings.js" defer></script>
    <script src="assets/js/uv-index.js" defer></script>
    <script src="assets/js/app.js" defer></script>
    <script>
      // Register service worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(reg => console.log('SW registered:', reg))
            .catch(err => console.log('SW registration failed:', err));
        });
      }
    </script>
  </body>
</html>